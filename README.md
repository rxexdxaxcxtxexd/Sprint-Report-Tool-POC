# Sprint Report CLI

Interactive command-line tool for generating executive-level sprint reports with human-in-the-loop workflow.

## Features

- **Human-in-the-Loop Workflow**: Confirm decisions at each step
- **JIRA MCP Integration**: Fetch sprint data via MCP Atlassian server
- **Fathom Transcript Search**: Smart filtering for relevant meetings
- **Claude AI Reports**: Executive-level summaries generated by Claude
- **Professional PDFs**: CSG-branded reports with proper formatting
- **Windows-Safe Filenames**: Fixes NTFS Alternate Data Stream issues

## Quick Start

### 1. Install Dependencies

```bash
# Create virtual environment (recommended)
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install Python packages
pip install -r requirements.txt
```

**Note:** WeasyPrint requires GTK3 on Windows:
- Download and install from: https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer
- Or use older version: `pip install weasyprint==58.1` (fewer dependencies)

### 2. Configure Environment

```bash
# Copy template and edit with your credentials
cp .env.template .env

# Edit .env with your API keys:
# - ANTHROPIC_API_KEY (Claude AI)
# - FATHOM_API_KEY (Fathom Video)
# - JIRA_URL, JIRA_USERNAME, JIRA_API_TOKEN
```

### 3. Configure Settings

Edit `config.yaml` to customize:
- JIRA board ID and project
- Fathom search terms
- Team name and report styling
- Output preferences

### 4. Run the Tool

```bash
python cli/main.py
```

Follow the interactive prompts to:
1. Select a sprint
2. Confirm dates
3. Choose relevant Fathom transcripts
4. Review and edit the generated report
5. Generate PDF

## Usage

### Basic Usage

```bash
# Interactive mode (default)
python cli/main.py

# Specify custom board ID
python cli/main.py --board 38

# Custom config file
python cli/main.py --config /path/to/config.yaml
```

### Docker Requirements

The tool uses JIRA MCP which runs in Docker. Ensure:
- Docker Desktop is running
- MCP Atlassian image is available: `docker pull ghcr.io/sooperset/mcp-atlassian:latest`

### Workflow Steps

**Step 1: Select Sprint**
- Displays table of recent sprints from JIRA board
- Select by number (e.g., "3" for the third sprint)

**Step 2: Confirm Dates**
- Review sprint start and end dates
- Adjust manually if needed

**Step 3: Fetch Sprint Data**
- Automatically loads all issues from JIRA
- Calculates completion metrics

**Step 4: Select Transcripts**
- Smart search for "ibobs"/"ibops" in Fathom meetings
- High-confidence matches pre-selected
- Choose: specific numbers (1,2,5), "all high", "all", or "none"

**Step 5: Generate Report**
- Claude AI creates executive-level summary
- Follows CSG sprint report format guide
- Takes 30-60 seconds

**Step 6: Review Report**
- Preview first 1000 characters
- Options: accept, view full, or edit in notepad

**Step 7: Create PDF**
- Generates professional PDF with CSG branding
- Auto-opens if configured (config.yaml)
- Saves to `output/pdfs/`

## File Structure

```
sprint-report-cli/
├── cli/
│   ├── main.py              # Entry point
│   ├── interactive.py       # Rich UI workflow
│   ├── jira_mcp.py         # JIRA MCP integration
│   └── transcript_filter.py # Fathom filtering
├── api/
│   └── fathom_client.py    # Fathom API client
├── services/
│   ├── report_generator.py # Claude AI integration
│   └── pdf_generator.py    # PDF creation
├── utils/
│   ├── config.py           # Configuration loader
│   └── filename_utils.py   # Filename sanitization
├── templates/
│   └── csg_sprint_report_template.html
├── guides/
│   └── csg_sprint_report_guide.md
├── output/
│   ├── pdfs/               # Generated PDFs
│   └── html/               # Generated HTML
├── .env                     # API keys (not in git)
├── config.yaml             # Settings
└── requirements.txt        # Python dependencies
```

## Configuration

### Environment Variables (.env)

```bash
# Claude AI
ANTHROPIC_API_KEY=sk-ant-...

# Fathom Video
FATHOM_API_KEY=...

# JIRA
JIRA_URL=https://company.atlassian.net
JIRA_USERNAME=your.email@company.com
JIRA_API_TOKEN=...
```

### Settings (config.yaml)

```yaml
jira:
  default_board_id: 38
  default_project: BOPS

fathom:
  search_terms: ["ibobs", "ibops", "ibob", "ibop"]
  date_range_padding_days: 2

report:
  team_name: "iBOPS FY25 Agile Team"

output:
  auto_open_pdf: true
```

## Troubleshooting

### Docker Not Running

**Error:** `JIRA MCP Error: Docker command failed`

**Solution:**
1. Start Docker Desktop
2. Verify: `docker ps`
3. Pull image: `docker pull ghcr.io/sooperset/mcp-atlassian:latest`

### WeasyPrint Import Failed

**Error:** `WeasyPrint is not available`

**Solution (Windows):**
1. Install GTK3: https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer
2. Reinstall: `pip install --force-reinstall weasyprint`
3. Or use older version: `pip install weasyprint==58.1`

### 0 KB PDF Files

**Cause:** Colons in sprint names (e.g., "BOPS: Sprint 11") create NTFS Alternate Data Streams

**Solution:** This tool automatically sanitizes filenames! Colons are replaced with hyphens.

**Example:**
- Input: `BOPS: Sprint 11`
- Output: `BOPS-Sprint-11_2239.pdf` ✓

### Configuration Errors

**Error:** `Missing required environment variables`

**Solution:**
1. Check `.env` file exists (not `.env.template`)
2. Verify all API keys are set
3. No quotes around values in .env file

## Development

### Running Tests

```bash
# Test configuration loading
python utils/config.py

# Test JIRA MCP connection
python cli/jira_mcp.py

# Test interactive components
python cli/interactive.py
```

### Code Style

- Follow PEP 8
- Use type hints
- Docstrings for all functions
- Rich library for CLI output

## Architecture

### Design Principles

1. **Human-in-the-Loop**: User confirms at each decision point
2. **Code Reuse**: Leverages production-quality components from existing service
3. **Error Handling**: Clear messages with troubleshooting steps
4. **Cross-Platform**: Works on Windows (primary target)

### Key Improvements Over Web Service

| Aspect | Old (Web Service) | New (CLI Tool) |
|--------|-------------------|----------------|
| Interface | FastAPI + job queue | Interactive CLI |
| JIRA | Custom REST client (454 lines) | JIRA MCP (150 lines) |
| Workflow | Fully automated | Human-in-the-loop |
| Complexity | 3,400+ lines | ~2,000 lines |
| User Control | Limited | Full control at each step |

## Known Limitations

1. **Transcript Content**: MVP doesn't download full transcript text (only metadata)
   - Future: Integrate `fathom_client.get_meeting_transcript()`

2. **Async Performance**: Sequential processing (not parallelized)
   - Future: Fetch JIRA and Fathom data in parallel

3. **Test Coverage**: Manual testing only
   - Future: Add pytest unit and integration tests

4. **Platform**: Optimized for Windows
   - Future: Test and adapt for macOS/Linux

## Roadmap

- [ ] Full Fathom transcript integration
- [ ] Batch mode (process multiple sprints)
- [ ] Export to Confluence
- [ ] Email delivery
- [ ] Custom report templates
- [ ] Integration tests

## License

Internal tool for CSG Solutions. Not for distribution.

## Support

For issues or questions:
1. Check [Troubleshooting](#troubleshooting) section
2. Review error messages for specific guidance
3. Contact team lead

---

**Version:** 1.0.0
**Last Updated:** 2025-12-16
**Author:** Built with Claude Code
